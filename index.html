<!DOCTYPE html>
<html>
<head>
	<title>CF-Ex</title>
	<meta charset="utf-8">
	<style>
      table,
      th,
      td {
        padding: 10px;
        border: 1px solid black;
        border-collapse: collapse;
      }
    </style>
	<script type="text/javascript">
		function createTable(data, divs) {
			var stringTable = `<table border='1px'><thead><tr><th>idx</th><th>Nome</th><th>tempo</th><tr></thead><tbody>`
			var qnt = data['result'].length;
			var lines = 0;
			for(let i = 0; i < qnt; i += 1) {
				for(let j = 0; j < divs.length; j += 1) {
					if(data['result'][i]['name'].search(divs[j]) != -1 && data['result'][i]['phase'] != "FINISHED") {
						const startTimeSeconds = data['result'][i]['relativeTimeSeconds'] * -1;
						console.log(data['result'][i]);
						var days = Math.floor(startTimeSeconds / (60 * 60 * 24));
						var hours = Math.floor((startTimeSeconds - (days * 60 * 60 * 24)) / (60 * 60));
						var min = Math.floor((startTimeSeconds - (days * 60 * 60 * 24) - (hours * 3600)) / 60);
						stringTable += `<tr><td>${lines + 1}</td>
											<td><a href='https://codeforces.com/contests/${data['result'][i]['id']}' target="_blank">${data['result'][i]['name']}</a></td>
											<td>${days} dias ${hours}:${min}</td></tr>`;
						lines += 1;
						break;
					}
				}
			}
			stringTable += "</tbody></table>"
			if(lines == 0) {
				document.getElementById('noContest').innerHTML = "Sem contests no momento";
			} else {
				document.getElementById('mytable').innerHTML = stringTable;
			}
		}
		function test() {
			var baseUrl = 'https://codeforces.com/api/';
			var methodName = 'contest.list';
			var finalUrl = baseUrl + methodName;
			var rate = [];
			const https = new XMLHttpRequest();
			https.open("GET", finalUrl);
			if(document.getElementById('div1').checked) {
				rate.push(`Div. 1`);
			}
			if(document.getElementById('div2').checked) {
				rate.push(`Div. 2`);
			}
			if(document.getElementById('div3').checked) {
				rate.push(`Div. 3`);
			}
			if(document.getElementById('div4').checked) {
				rate.push(`Div. 4`);
			}
			https.onload = () => createTable(JSON.parse(https.responseText), rate);
			https.send();
		}
	</script>
</head>
<body>
	<div class="selectors">
		<label>	
			<input type="radio" id="div1">
			div 1
		</label>
		<br>
		<label>	
			<input type="radio" id="div2">
			div 2
		</label>
		<br>
		<label>	
			<input type="radio" id="div3">
			div 3
		</label>
		<br>
		<label>	
			<input type="radio" id="div4">
			div 4
		</label>
		<div id="noContest"></div>
		<table id='mytable'></table>
		<button onclick="test()">Buscar contests</button>
	</div>
</body>
</html>